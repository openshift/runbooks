# ClusterLogForwarderOutputErrorRate

## Meaning

The `ClusterLogForwarderOutputErrorRate` alert indicates that the log collector
is experiencing a sustained error rate (at least 10% over the last 5 minutes,
persisting for 5 minutes) while trying to forward logs to a specific Output.
The alert identifies error for the specific output of the specific instance of
a ClusterLogForwarder.  Typically, this indicates a misconfiguration of the
`ClusterLogForwarder` or the service destination is unavailable.

## Impact

Log forwarding to the destination is impaired and may result in data loss at
the configured log store.

## Diagnosis

1. Examine `ClusterLogForwarderOutputErrorRate` alert details in the OpenShift
console:
    - Note the error being generated by the collector
      - (i.e. "error trying to connect: dns error: failed to lookup address
        information: Name or service not known")
    - Note the key labels:
        - `app_kubernetes_io_instance`: The name of the collector.
        - `namespace`: Namespace of the collector.
        - `component_id`: The ID of the specific sink in the log collector
        that is failing
        (i.e `output_lokistack_otlp_application`, `output_my_splunk`).
2. Review the `ClusterLogForwarder` (CLF) configuration:
    1. Identify the output definition corresponding to the `component_id`
    obtained from the alert details.
        - See naming schemas for
        [non-Lokistack](./ClusterLogForwarderConfigNamingSchema.md#non-lokistack-outputs)
        and
        [Lokistack](./ClusterLogForwarderConfigNamingSchema.md#lokistack-outputs)
        outputs.
3. Verify the log receiver:
    - Verify the service is available.
    - Verify the authorization credentials.
4. Verify the `ClusterLogForwarder`
    - Verify the URL of the output is correct for the service
    - Verify the TLS configuration is correct for the service by inspecting the
     spec'd secrets and configmaps
    - Verify the authorization credentials are correct for the service by inspecting
    the spec'd secrets

## Mitigation

Mitigation of the issue depends upon the error message displayed by the alert.
The steps identified below are not all inclusive for this alert.

### ClusterLogForwarder Configuration

If a typo or misconfiguration is identified within the
CLF custom resource, directly edit the resource to fix the error.

### Credential Update

If the issue stems from incorrect or expired authentication
credentials, update the associated OpenShift `Secret` with the correct and valid
credentials.

### TLS Certificate Update

If the issue stems from incorrect or expired certicates, update the associated
OpenShift `Secret` or `ConfigMap` with the correct and valid certificates.

## Notes

- [Naming schemas](./ClusterLogForwarderConfigNamingSchema.md)
